<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nmap Timing Template Visualizer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 30px;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            padding: 50px;
        }

        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 15px;
            font-size: 2.5em;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 50px;
            font-size: 1.1em;
        }

        .timing-selector {
            margin-bottom: 60px;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
        }

        .timing-template-section {
            display: flex;
            flex-direction: column;
        }

        .parameter-sliders-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .parameter-sliders-section h3 {
            color: #667eea;
            margin-bottom: 25px;
            font-size: 1.3em;
        }

        .param-slider-item {
            margin-bottom: 30px;
        }

        .param-slider-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.9em;
            font-weight: 600;
            color: #555;
        }

        .param-slider-value {
            color: #667eea;
            font-family: 'Courier New', monospace;
            font-size: 0.95em;
        }

        .param-slider {
            width: 100%;
            height: 12px;
            border-radius: 6px;
            background: #e0e0e0;
            outline: none;
            opacity: 0.9;
            transition: opacity 0.2s;
            -webkit-appearance: none;
            appearance: none;
            cursor: pointer;
        }

        .param-slider:hover {
            opacity: 1;
        }

        .param-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
        }

        .param-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #667eea;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.2);
            border: none;
        }

        .param-slider-min-max {
            display: flex;
            justify-content: space-between;
            font-size: 0.75em;
            color: #999;
            margin-top: 5px;
        }

        .param-description {
            font-size: 0.8em;
            color: #666;
            margin-top: 10px;
            line-height: 1.4;
            font-style: italic;
        }

        .param-slider-item {
            position: relative;
        }

        .param-slider-item:hover .param-description {
            color: #333;
        }

        @media (max-width: 968px) {
            .timing-selector {
                grid-template-columns: 1fr;
            }
        }

        .slider-container {
            position: relative;
            margin: 35px 0;
        }

        .slider {
            width: 100%;
            height: 20px;
            border-radius: 10px;
            background: linear-gradient(to right, 
                #e74c3c 0%, 
                #f39c12 16.66%, 
                #f1c40f 33.33%, 
                #27ae60 50%, 
                #3498db 66.66%, 
                #9b59b6 100%);
            outline: none;
            opacity: 0.9;
            transition: opacity 0.2s;
            -webkit-appearance: none;
            appearance: none;
        }

        .slider:hover {
            opacity: 1;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #fff;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            border: 3px solid #667eea;
        }

        .slider::-moz-range-thumb {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #fff;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            border: 3px solid #667eea;
        }

        .template-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9em;
            color: #666;
        }

        .template-name {
            text-align: center;
            font-size: 1.8em;
            font-weight: bold;
            margin: 25px 0 20px 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .template-description {
            text-align: center;
            color: #666;
            font-size: 0.95em;
            line-height: 1.7;
            margin: 0 20px 20px 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .fine-grained-description {
            text-align: center;
            color: #666;
            font-size: 0.9em;
            line-height: 1.7;
            margin: 0 20px 25px 20px;
            padding: 20px;
            background: #f0f4ff;
            border-radius: 8px;
            border-left: 4px solid #764ba2;
        }

        .metrics-container {
            display: grid;
            gap: 35px;
            margin-bottom: 40px;
        }

        .metric-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .metric-title {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 20px;
            color: #667eea;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .metric-value {
            font-size: 0.9em;
            color: #666;
            font-weight: normal;
        }

        .bar-container {
            height: 40px;
            background: #e0e0e0;
            border-radius: 20px;
            overflow: hidden;
            position: relative;
            margin-bottom: 10px;
        }

        .bar-fill {
            height: 100%;
            border-radius: 20px;
            transition: width 0.3s ease, background 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 15px;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }

        .timing-args {
            margin-top: 30px;
            margin-bottom: 30px;
            padding: 25px;
            background: #fff;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .timing-args h3 {
            margin-bottom: 20px;
            color: #667eea;
        }

        .arg-item {
            padding: 10px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }

        .arg-item:last-child {
            border-bottom: none;
        }

        .arg-label {
            font-weight: bold;
            color: #555;
        }

        .arg-value {
            color: #667eea;
        }

        .detection-level {
            color: #e74c3c;
        }

        .detection-level.medium {
            color: #f39c12;
        }

        .detection-level.low {
            color: #27ae60;
        }

        .command-display {
            margin-top: 35px;
            margin-bottom: 20px;
            padding: 25px;
            background: #2d2d2d;
            border-radius: 8px;
            color: #f8f8f2;
            font-family: 'Courier New', monospace;
            font-size: 0.95em;
            overflow-x: auto;
            border-left: 4px solid #667eea;
            position: relative;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .command-display-content {
            flex: 1;
            min-width: 0;
        }

        .command-display .prompt {
            color: #50fa7b;
        }

        .command-display .command {
            color: #bd93f9;
        }

        .command-display .args {
            color: #f1fa8c;
        }

        .copy-button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 0.9em;
            font-weight: 600;
            transition: background 0.2s, transform 0.1s;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .copy-button:hover {
            background: #5568d3;
        }

        .copy-button:active {
            transform: scale(0.95);
        }

        .copy-button.copied {
            background: #27ae60;
        }

        .granular-command-display {
            margin-top: 25px;
            margin-bottom: 25px;
            padding: 25px;
            background: #2d2d2d;
            border-radius: 8px;
            color: #f8f8f2;
            font-family: 'Courier New', monospace;
            font-size: 0.95em;
            overflow-x: auto;
            border-left: 4px solid #27ae60;
            position: relative;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .granular-command-display-content {
            flex: 1;
            min-width: 0;
        }

        .granular-command-display #granularNmapCommand {
            color: #f1fa8c;
        }

        .footer {
            margin-top: 60px;
            padding-top: 40px;
            padding-bottom: 20px;
            border-top: 2px solid #e0e0e0;
            text-align: center;
        }

        .footer h4 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.1em;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            font-size: 0.9em;
        }

        .footer-links a {
            color: #667eea;
            text-decoration: none;
            transition: color 0.2s;
        }

        .footer-links a:hover {
            color: #764ba2;
            text-decoration: underline;
        }

    </style>
</head>
<body>
    <div class="container">
        <h1>Nmap Timing Template Visualizer</h1>
        <p class="subtitle">Interactive visualization of Nmap timing parameters and performance metrics</p>

        <div class="timing-selector">
            <div class="timing-template-section">
                <div class="slider-container">
                    <input type="range" min="0" max="5" value="3" class="slider" id="timingSlider">
                    <div class="template-labels">
                        <span>0<br>Paranoid</span>
                        <span>1<br>Sneaky</span>
                        <span>2<br>Polite</span>
                        <span>3<br>Normal</span>
                        <span>4<br>Aggressive</span>
                        <span>5<br>Insane</span>
                    </div>
                </div>
                <div class="template-name" id="templateName">Normal</div>
                <div class="template-description" id="templateDescription">
                    Nmap's timing templates (0-5) provide a simple way to control scan aggressiveness without manually configuring dozens of parameters. Each template sets multiple timing values simultaneously: <strong>Paranoid (T0)</strong> and <strong>Sneaky (T1)</strong> serialize scans and add long delays (5 minutes to 15 seconds between probes) to evade IDS detection—ideal for stealth but extremely slow. <strong>Polite (T2)</strong> adds 400ms delays to reduce bandwidth and target load, but scans can take 10x longer than default. <strong>Normal (T3)</strong> is the balanced default with adaptive timing. <strong>Aggressive (T4)</strong> caps TCP scan delays at 10ms and reduces retries to 6, assuming fast reliable networks—recommended for modern infrastructure. <strong>Insane (T5)</strong> minimizes all timeouts (300ms max RTT, 5ms TCP delay, only 2 retries) for maximum speed, sacrificing some accuracy. Templates can be combined with fine-grained controls; granular options override template defaults for specific parameters.
                </div>
                <div class="fine-grained-description">
                    <strong>Fine-Grained Timing Controls:</strong> Beyond templates, Nmap offers precise control over scan behavior. <strong>Hostgroup size</strong> (--min-hostgroup, --max-hostgroup) determines how many hosts are scanned concurrently—larger groups are faster but delay results. <strong>Parallelism</strong> (--min-parallelism, --max-parallelism) controls concurrent probes per host—higher values speed scans but may overwhelm targets or trigger rate limiting. <strong>Probe timeouts</strong> (--min-rtt-timeout, --max-rtt-timeout, --initial-rtt-timeout) define how long Nmap waits for responses—lower values speed up scans on fast networks but cause false negatives on slow links. <strong>Retransmissions</strong> (--max-retries) determine persistence—more retries improve accuracy on unreliable networks but slow scans. <strong>Scan delays</strong> (--scan-delay, --max-scan-delay) insert pauses between probes to avoid rate limiting—critical for UDP scans where Linux kernels limit ICMP errors to 1/second. <strong>Rate limiting</strong> (--min-rate, --max-rate) directly controls packets per second. Nmap's adaptive algorithms (congestion control, RTT estimation, exponential backoff) dynamically adjust these parameters based on detected network conditions, packet loss, and latency—ensuring optimal balance between speed and accuracy without manual tuning.
                </div>
                <div style="text-align: center; margin-top: 10px; font-size: 0.9em; color: #667eea; display: none;" id="customIndicator">
                    <em>Custom parameters - adjust sliders below</em>
                </div>
            </div>
            <div class="parameter-sliders-section">
                <h3>Timing Parameters</h3>
                <div class="param-slider-item">
                    <div class="param-slider-label">
                        <span>--max-rtt-timeout</span>
                        <span class="param-slider-value" id="paramMaxRttValue">1000ms</span>
                    </div>
                    <input type="range" min="50" max="5000" value="1000" class="param-slider" id="paramMaxRtt"
                           aria-label="Maximum round trip timeout in milliseconds" 
                           title="Maximum time to wait for probe response before retransmitting or giving up">
                    <div class="param-slider-min-max">
                        <span>50ms</span>
                        <span>5000ms</span>
                    </div>
                    <div class="param-description">
                        Maximum time Nmap waits for a probe response. Higher values handle slow networks better but increase scan time. Lower values (300-1250ms) speed up scans on fast networks. T0-T2 use 5min-10s, T3-T4 use 1000-1250ms, T5 uses 300ms.
                    </div>
                </div>
                <div class="param-slider-item">
                    <div class="param-slider-label">
                        <span>--min-rtt-timeout</span>
                        <span class="param-slider-value" id="paramMinRttValue">100ms</span>
                    </div>
                    <input type="range" min="50" max="5000" value="100" class="param-slider" id="paramMinRtt"
                           aria-label="Minimum round trip timeout in milliseconds"
                           title="Minimum round trip time timeout used as lower bound">
                    <div class="param-slider-min-max">
                        <span>50ms</span>
                        <span>5000ms</span>
                    </div>
                    <div class="param-description">
                        Lower bound for round trip timeout calculations. Rarely adjusted manually. T0-T4 use 100ms, T5 uses 50ms. Only useful for extremely unreliable networks.
                    </div>
                </div>
                <div class="param-slider-item">
                    <div class="param-slider-label">
                        <span>--initial-rtt-timeout</span>
                        <span class="param-slider-value" id="paramInitialRttValue">500ms</span>
                    </div>
                    <input type="range" min="50" max="5000" value="500" class="param-slider" id="paramInitialRtt"
                           aria-label="Initial round trip timeout in milliseconds"
                           title="Starting round trip timeout for first probes before adapting">
                    <div class="param-slider-min-max">
                        <span>50ms</span>
                        <span>5000ms</span>
                    </div>
                    <div class="param-description">
                        Starting timeout value for first probes before Nmap adapts based on responses. T0 uses 5min, T1 uses 15s, T2-T3 use 1s, T4 uses 500ms, T5 uses 250ms. Lower values speed up initial scans.
                    </div>
                </div>
                <div class="param-slider-item">
                    <div class="param-slider-label">
                        <span>--max-retries</span>
                        <span class="param-slider-value" id="paramMaxRetriesValue">10</span>
                    </div>
                    <input type="range" min="0" max="10" value="10" class="param-slider" id="paramMaxRetries"
                           aria-label="Maximum number of probe retransmissions"
                           title="Maximum retransmissions before giving up on a port">
                    <div class="param-slider-min-max">
                        <span>0</span>
                        <span>10</span>
                    </div>
                    <div class="param-description">
                        Maximum probe retransmissions before giving up. Higher values improve accuracy on unreliable networks but slow scans. T0-T3 use 10 retries, T4 uses 6, T5 uses 2. Set to 0 for fastest scans but lower accuracy.
                    </div>
                </div>
                <div class="param-slider-item">
                    <div class="param-slider-label">
                        <span>--max-scan-delay</span>
                        <span class="param-slider-value" id="paramMaxScanDelayValue">Adaptive</span>
                    </div>
                    <input type="range" min="0" max="300000" value="0" class="param-slider" id="paramMaxScanDelay"
                           aria-label="Maximum delay between probes in milliseconds"
                           title="Largest delay allowed between probes to avoid rate limiting">
                    <div class="param-slider-min-max">
                        <span>0ms (adaptive)</span>
                        <span>300000ms (5min)</span>
                    </div>
                    <div class="param-description">
                        Maximum delay between probes. Set to 0 for adaptive behavior (T3-T5). T0-T2 use delays of 5min-400ms for stealth. T4 caps at 10ms, T5 at 5ms. Higher delays avoid rate limiting and IDS detection but slow scans dramatically.
                    </div>
                </div>
                <div class="param-slider-item">
                    <div class="param-slider-label">
                        <span>Parallelism</span>
                        <span class="param-slider-value" id="paramParallelismValue">~100</span>
                    </div>
                    <input type="range" min="0" max="300" value="100" class="param-slider" id="paramParallelism"
                           aria-label="Number of concurrent probes per host group"
                           title="Total concurrent probes outstanding for a host group">
                    <div class="param-slider-min-max">
                        <span>0 (Serial)</span>
                        <span>300+</span>
                    </div>
                    <div class="param-description">
                        Number of concurrent probes sent simultaneously. 0 = serial (one at a time, T0-T2 behavior). T3-T5 use dynamic parallelism (typically 100-300+). Higher values speed scans but may overwhelm targets or trigger rate limiting.
                    </div>
                </div>
            </div>
        </div>

        <div class="metrics-container">
            <div class="metric-card">
                <div class="metric-title">
                    Detection Level (Stealth)
                    <span class="metric-value" id="detectionLevel">Moderate</span>
                </div>
                <div class="bar-container" 
                     title="Higher = More stealthy. Based on timeouts, delays, and parallelism. T0-T1 maximize stealth, T5 prioritizes speed over stealth."
                     aria-label="Detection level bar showing stealth level from 0 to 100 percent">
                    <div class="bar-fill" id="detectionBar" style="width: 50%; background: linear-gradient(90deg, #27ae60, #f39c12);"></div>
                </div>
                <div class="param-description">
                    Measures scan stealthiness. Higher values use longer timeouts and delays to avoid IDS detection. T0-T1 (Paranoid/Sneaky) maximize stealth. Lower values prioritize speed but are more detectable.
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-title">
                    Scan Speed
                    <span class="metric-value" id="speedValue">Normal</span>
                </div>
                <div class="bar-container"
                     title="Relative scan speed. Higher = faster scans. Affected by RTT timeouts, delays, retries, and parallelism."
                     aria-label="Scan speed bar showing relative speed from 0 to 100 percent">
                    <div class="bar-fill" id="speedBar" style="width: 50%; background: linear-gradient(90deg, #3498db, #2ecc71);"></div>
                </div>
                <div class="param-description">
                    Relative scanning speed compared across templates. T0 is extremely slow (5min delays), T5 is maximum speed (minimal delays, low retries). Speed increases with lower timeouts, fewer retries, higher parallelism, and minimal delays.
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-title">
                    Port Knocks (Probes per Port)
                    <span class="metric-value" id="knocksValue">10</span>
                </div>
                <div class="bar-container"
                     title="Number of probe attempts per port before giving up. Equal to max-retries setting."
                     aria-label="Port knocks bar showing number of retries from 0 to 10">
                    <div class="bar-fill" id="knocksBar" style="width: 50%; background: linear-gradient(90deg, #9b59b6, #e74c3c);"></div>
                </div>
                <div class="param-description">
                    Number of probe retransmissions per port. Maps directly to --max-retries. T0-T3 use 10 retries for accuracy, T4 uses 6, T5 uses 2. More retries improve accuracy but increase scan time, especially on filtered or rate-limited ports.
                </div>
            </div>

            <div class="metric-card">
                <div class="metric-title">
                    Parallelism (Concurrent Probes)
                    <span class="metric-value" id="parallelismValue">Dynamic</span>
                </div>
                <div class="bar-container"
                     title="Number of probes sent simultaneously. 0 = serial (T0-T2), higher = more parallel (T3-T5)."
                     aria-label="Parallelism bar showing concurrent probes from 0 to 300">
                    <div class="bar-fill" id="parallelismBar" style="width: 50%; background: linear-gradient(90deg, #16a085, #3498db);"></div>
                </div>
                <div class="param-description">
                    Number of concurrent probes sent at once. T0-T2 use serial scanning (parallelism = 1) for maximum stealth. T3-T5 use dynamic parallelism (typically 100-300+) for speed. Higher parallelism speeds scans but may overwhelm targets or trigger security controls.
                </div>
            </div>
        </div>

        <div class="timing-args">
            <h3>Timing Arguments</h3>
            <div id="timingArgs"></div>
        </div>

        <div class="command-display">
            <div class="command-display-content">
                <span class="prompt">$</span> <span class="command">nmap</span> <span class="args" id="nmapCommand">-T3 target</span>
            </div>
            <button class="copy-button" id="copyNmapButton" data-command="simple">Copy</button>
        </div>

        <div class="granular-command-display">
            <div class="granular-command-display-content">
                <span class="prompt">$</span> <span id="granularNmapCommand">nmap -T3 target</span>
            </div>
            <button class="copy-button" id="copyGranularButton" data-command="granular">Copy</button>
        </div>

        <footer class="footer">
            <h4>Sources</h4>
            <div class="footer-links">
                <a href="https://nmap.org/book/performance-timing-templates.html" target="_blank" rel="noopener noreferrer">Nmap Timing Templates</a>
                <a href="https://nmap.org/book/man-performance.html" target="_blank" rel="noopener noreferrer">Nmap Performance Documentation</a>
            </div>
        </footer>

    </div>

    <script>
        const timingData = {
            0: { // Paranoid
                name: 'Paranoid',
                detectionLevel: 100,
                detectionText: 'Very Stealth',
                speed: 5,
                speedText: 'Extremely Slow',
                knocks: 10,
                knocksText: '10 retries',
                parallelism: 0,
                parallelismText: 'Serial (1 at a time)',
                maxRttTimeout: '5000ms',
                maxRttTimeoutMs: 5000,
                minRttTimeout: '5000ms',
                minRttTimeoutMs: 5000,
                initialRttTimeout: '5000ms',
                initialRttTimeoutMs: 5000,
                maxRetries: 10,
                scanDelay: '300s (5min)',
                maxScanDelay: '300s',
                maxScanDelayMs: 300000,
                hostTimeout: '0 (none)',
                scriptTimeout: '0 (none)',
                command: '-T0'
            },
            1: { // Sneaky
                name: 'Sneaky',
                detectionLevel: 95,
                detectionText: 'Very Stealth',
                speed: 8,
                speedText: 'Very Slow',
                knocks: 10,
                knocksText: '10 retries',
                parallelism: 10,
                parallelismText: 'Very Low (~10)',
                maxRttTimeout: '1500ms',
                maxRttTimeoutMs: 1500,
                minRttTimeout: '1500ms',
                minRttTimeoutMs: 1500,
                initialRttTimeout: '1500ms',
                initialRttTimeoutMs: 1500,
                maxRetries: 10,
                scanDelay: '15s',
                maxScanDelay: '15s',
                maxScanDelayMs: 15000,
                hostTimeout: '0 (none)',
                scriptTimeout: '0 (none)',
                command: '-T1'
            },
            2: { // Polite
                name: 'Polite',
                detectionLevel: 75,
                detectionText: 'Stealth',
                speed: 15,
                speedText: 'Slow',
                knocks: 10,
                knocksText: '10 retries',
                parallelism: 50,
                parallelismText: 'Low (~50)',
                maxRttTimeout: '1000ms',
                maxRttTimeoutMs: 1000,
                minRttTimeout: '400ms',
                minRttTimeoutMs: 400,
                initialRttTimeout: '400ms',
                initialRttTimeoutMs: 400,
                maxRetries: 10,
                scanDelay: '400ms',
                maxScanDelay: '400ms',
                maxScanDelayMs: 400,
                hostTimeout: '0 (none)',
                scriptTimeout: '0 (none)',
                command: '-T2'
            },
            3: { // Normal
                name: 'Normal',
                detectionLevel: 50,
                detectionText: 'Moderate',
                speed: 50,
                speedText: 'Normal',
                knocks: 10,
                knocksText: '10 retries',
                parallelism: 100,
                parallelismText: 'Dynamic (~100)',
                maxRttTimeout: '1000ms',
                maxRttTimeoutMs: 1000,
                minRttTimeout: '100ms',
                minRttTimeoutMs: 100,
                initialRttTimeout: '500ms',
                initialRttTimeoutMs: 500,
                maxRetries: 10,
                scanDelay: '0 (adaptive)',
                maxScanDelay: '0 (adaptive)',
                maxScanDelayMs: 0,
                hostTimeout: '0 (none)',
                scriptTimeout: '0 (none)',
                command: '-T3'
            },
            4: { // Aggressive
                name: 'Aggressive',
                detectionLevel: 25,
                detectionText: 'Low Stealth',
                speed: 85,
                speedText: 'Fast',
                knocks: 6,
                knocksText: '6 retries',
                parallelism: 200,
                parallelismText: 'High (~200)',
                maxRttTimeout: '1250ms',
                maxRttTimeoutMs: 1250,
                minRttTimeout: '100ms',
                minRttTimeoutMs: 100,
                initialRttTimeout: '500ms',
                initialRttTimeoutMs: 500,
                maxRetries: 6,
                scanDelay: '0 (adaptive)',
                maxScanDelay: '10ms',
                maxScanDelayMs: 10,
                hostTimeout: '0 (none)',
                scriptTimeout: '0 (none)',
                command: '-T4'
            },
            5: { // Insane
                name: 'Insane',
                detectionLevel: 5,
                detectionText: 'No Stealth',
                speed: 100,
                speedText: 'Maximum',
                knocks: 2,
                knocksText: '2 retries',
                parallelism: 300,
                parallelismText: 'Maximum (~300+)',
                maxRttTimeout: '300ms',
                maxRttTimeoutMs: 300,
                minRttTimeout: '50ms',
                minRttTimeoutMs: 50,
                initialRttTimeout: '250ms',
                initialRttTimeoutMs: 250,
                maxRetries: 2,
                scanDelay: '0 (adaptive)',
                maxScanDelay: '5ms',
                maxScanDelayMs: 5,
                hostTimeout: '15m',
                scriptTimeout: '10m',
                command: '-T5'
            }
        };

        const slider = document.getElementById('timingSlider');
        const templateName = document.getElementById('templateName');
        const detectionLevel = document.getElementById('detectionLevel');
        const detectionBar = document.getElementById('detectionBar');
        const speedValue = document.getElementById('speedValue');
        const speedBar = document.getElementById('speedBar');
        const knocksValue = document.getElementById('knocksValue');
        const knocksBar = document.getElementById('knocksBar');
        const parallelismValue = document.getElementById('parallelismValue');
        const parallelismBar = document.getElementById('parallelismBar');
        const timingArgs = document.getElementById('timingArgs');
        const nmapCommand = document.getElementById('nmapCommand');
        const granularNmapCommand = document.getElementById('granularNmapCommand');
        const copyNmapButton = document.getElementById('copyNmapButton');
        const copyGranularButton = document.getElementById('copyGranularButton');

        // Parameter slider elements
        const paramMaxRtt = document.getElementById('paramMaxRtt');
        const paramMaxRttValue = document.getElementById('paramMaxRttValue');
        const paramMinRtt = document.getElementById('paramMinRtt');
        const paramMinRttValue = document.getElementById('paramMinRttValue');
        const paramInitialRtt = document.getElementById('paramInitialRtt');
        const paramInitialRttValue = document.getElementById('paramInitialRttValue');
        const paramMaxRetries = document.getElementById('paramMaxRetries');
        const paramMaxRetriesValue = document.getElementById('paramMaxRetriesValue');
        const paramMaxScanDelay = document.getElementById('paramMaxScanDelay');
        const paramMaxScanDelayValue = document.getElementById('paramMaxScanDelayValue');
        const paramParallelism = document.getElementById('paramParallelism');
        const paramParallelismValue = document.getElementById('paramParallelismValue');
        const customIndicator = document.getElementById('customIndicator');
        
        let isCustomMode = false;
        let currentTemplate = 3;

        function updateMetrics(value) {
            currentTemplate = value;
            isCustomMode = false;
            customIndicator.style.display = 'none';
            const data = timingData[value];

            // Update template name
            templateName.textContent = data.name;

            // Update detection level
            detectionLevel.textContent = data.detectionText;
            detectionLevel.className = 'metric-value detection-level ' + 
                (data.detectionLevel > 70 ? '' : data.detectionLevel > 30 ? 'medium' : 'low');
            detectionBar.style.width = data.detectionLevel + '%';
            detectionBar.style.background = data.detectionLevel > 70 ? 
                'linear-gradient(90deg, #27ae60, #2ecc71)' : 
                data.detectionLevel > 30 ? 
                'linear-gradient(90deg, #f39c12, #e67e22)' : 
                'linear-gradient(90deg, #e74c3c, #c0392b)';

            // Update speed
            speedValue.textContent = data.speedText;
            speedBar.style.width = data.speed + '%';
            speedBar.style.background = data.speed < 30 ? 
                'linear-gradient(90deg, #3498db, #2980b9)' : 
                data.speed < 70 ? 
                'linear-gradient(90deg, #2ecc71, #27ae60)' : 
                'linear-gradient(90deg, #f39c12, #e67e22)';

            // Update knocks
            knocksValue.textContent = data.knocksText;
            const knocksPercent = (data.knocks / 10) * 100;
            knocksBar.style.width = knocksPercent + '%';
            knocksBar.textContent = data.knocks + ' retries';

            // Update parallelism
            parallelismValue.textContent = data.parallelismText;
            const parallelismPercent = (data.parallelism / 300) * 100;
            parallelismBar.style.width = parallelismPercent + '%';
            if (data.parallelism === 0) {
                parallelismBar.textContent = 'Serial';
            } else {
                parallelismBar.textContent = '~' + data.parallelism + ' probes';
            }

            // Update timing arguments
            timingArgs.innerHTML = `
                <div class="arg-item">
                    <span class="arg-label">--max-rtt-timeout</span>
                    <span class="arg-value">${data.maxRttTimeout}</span>
                </div>
                <div class="arg-item">
                    <span class="arg-label">--min-rtt-timeout</span>
                    <span class="arg-value">${data.minRttTimeout}</span>
                </div>
                <div class="arg-item">
                    <span class="arg-label">--initial-rtt-timeout</span>
                    <span class="arg-value">${data.initialRttTimeout}</span>
                </div>
                <div class="arg-item">
                    <span class="arg-label">--max-retries</span>
                    <span class="arg-value">${data.maxRetries}</span>
                </div>
                <div class="arg-item">
                    <span class="arg-label">--scan-delay</span>
                    <span class="arg-value">${data.scanDelay}</span>
                </div>
                <div class="arg-item">
                    <span class="arg-label">--max-scan-delay</span>
                    <span class="arg-value">${data.maxScanDelay}</span>
                </div>
                <div class="arg-item">
                    <span class="arg-label">--host-timeout</span>
                    <span class="arg-value">${data.hostTimeout}</span>
                </div>
                <div class="arg-item">
                    <span class="arg-label">--script-timeout</span>
                    <span class="arg-value">${data.scriptTimeout}</span>
                </div>
            `;

            // Update command
            nmapCommand.textContent = `${data.command} target`;

            // Update parameter sliders
            paramMaxRtt.value = data.maxRttTimeoutMs;
            paramMaxRttValue.textContent = data.maxRttTimeout;
            
            paramMinRtt.value = data.minRttTimeoutMs;
            paramMinRttValue.textContent = data.minRttTimeout;
            
            paramInitialRtt.value = data.initialRttTimeoutMs;
            paramInitialRttValue.textContent = data.initialRttTimeout;
            
            paramMaxRetries.value = data.maxRetries;
            paramMaxRetriesValue.textContent = data.maxRetries;
            
            paramMaxScanDelay.value = data.maxScanDelayMs;
            if (data.maxScanDelayMs === 0) {
                paramMaxScanDelayValue.textContent = 'Adaptive';
            } else if (data.maxScanDelayMs >= 1000) {
                paramMaxScanDelayValue.textContent = (data.maxScanDelayMs / 1000) + 's';
            } else {
                paramMaxScanDelayValue.textContent = data.maxScanDelayMs + 'ms';
            }
            
            paramParallelism.value = data.parallelism;
            paramParallelismValue.textContent = data.parallelism === 0 ? 'Serial' : '~' + data.parallelism;

            // Update granular command
            const granularCmd = buildGranularCommand(data);
            granularNmapCommand.textContent = granularCmd;
        }

        function buildGranularCommand(data) {
            let cmd = 'nmap';
            
            // Helper to clean value (remove parenthetical comments)
            const cleanValue = (value) => {
                if (typeof value === 'string') {
                    // Remove anything in parentheses and trim
                    return value.replace(/\s*\([^)]*\)/g, '').trim();
                }
                return value;
            };
            
            // Helper to check if value should be skipped
            const shouldSkip = (value) => {
                const clean = cleanValue(value);
                return clean === '0' || clean === 'none' || clean === 'adaptive' || clean === '';
            };
            
            // Add timing arguments
            if (!shouldSkip(data.maxRttTimeout)) {
                cmd += ` --max-rtt-timeout ${cleanValue(data.maxRttTimeout)}`;
            }
            
            if (!shouldSkip(data.minRttTimeout)) {
                cmd += ` --min-rtt-timeout ${cleanValue(data.minRttTimeout)}`;
            }
            
            if (!shouldSkip(data.initialRttTimeout)) {
                cmd += ` --initial-rtt-timeout ${cleanValue(data.initialRttTimeout)}`;
            }
            
            cmd += ` --max-retries ${data.maxRetries}`;
            
            // Only add scan-delay if it's not adaptive/0
            if (!shouldSkip(data.scanDelay)) {
                cmd += ` --scan-delay ${cleanValue(data.scanDelay)}`;
            }
            
            // Only add max-scan-delay if it's not adaptive/0
            if (!shouldSkip(data.maxScanDelay)) {
                cmd += ` --max-scan-delay ${cleanValue(data.maxScanDelay)}`;
            }
            
            // Add host-timeout if set
            if (!shouldSkip(data.hostTimeout)) {
                cmd += ` --host-timeout ${cleanValue(data.hostTimeout)}`;
            }
            
            // Add script-timeout if set
            if (!shouldSkip(data.scriptTimeout)) {
                cmd += ` --script-timeout ${cleanValue(data.scriptTimeout)}`;
            }
            
            cmd += ' target';
            
            return cmd;
        }

        // Copy button functionality
        function copyToClipboard(text, button) {
            navigator.clipboard.writeText(text).then(() => {
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                button.classList.add('copied');
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy:', err);
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = text;
                textArea.style.position = 'fixed';
                textArea.style.opacity = '0';
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    const originalText = button.textContent;
                    button.textContent = 'Copied!';
                    button.classList.add('copied');
                    setTimeout(() => {
                        button.textContent = originalText;
                        button.classList.remove('copied');
                    }, 2000);
                } catch (err) {
                    console.error('Fallback copy failed:', err);
                }
                document.body.removeChild(textArea);
            });
        }

        copyNmapButton.addEventListener('click', () => {
            // Get the full command text from the display
            const commandDisplay = copyNmapButton.previousElementSibling;
            const commandText = commandDisplay.textContent.trim().replace(/^\$\s*/, '');
            copyToClipboard(commandText, copyNmapButton);
        });

        copyGranularButton.addEventListener('click', () => {
            // Get the full command text from the display
            const commandDisplay = copyGranularButton.previousElementSibling;
            const commandText = commandDisplay.textContent.trim().replace(/^\$\s*/, '');
            copyToClipboard(commandText, copyGranularButton);
        });

        // Function to calculate metrics from current parameter values
        function calculateMetricsFromParams() {
            const maxRtt = parseInt(paramMaxRtt.value);
            const minRtt = parseInt(paramMinRtt.value);
            const initialRtt = parseInt(paramInitialRtt.value);
            const retries = parseInt(paramMaxRetries.value);
            const maxScanDelay = parseInt(paramMaxScanDelay.value);
            const parallelism = parseInt(paramParallelism.value);

            // Calculate detection level (stealth) - lower timeouts, higher delays = more stealth
            let detectionLevel = 50; // base
            if (maxRtt > 4000) detectionLevel += 30;
            else if (maxRtt > 2000) detectionLevel += 20;
            else if (maxRtt > 1000) detectionLevel += 10;
            
            if (maxScanDelay > 100000) detectionLevel += 20;
            else if (maxScanDelay > 10000) detectionLevel += 15;
            else if (maxScanDelay > 0) detectionLevel += 5;
            
            if (parallelism === 0) detectionLevel += 20;
            else if (parallelism < 50) detectionLevel += 10;
            else if (parallelism > 200) detectionLevel -= 15;
            
            detectionLevel = Math.max(0, Math.min(100, detectionLevel));

            // Calculate speed - lower timeouts, lower delays, higher parallelism = faster
            let speed = 50; // base
            if (maxRtt < 500) speed += 30;
            else if (maxRtt < 1000) speed += 15;
            else if (maxRtt > 2000) speed -= 20;
            
            if (maxScanDelay === 0) speed += 15;
            else if (maxScanDelay < 100) speed += 10;
            else if (maxScanDelay > 10000) speed -= 30;
            
            if (parallelism === 0) speed -= 30;
            else if (parallelism > 200) speed += 20;
            else if (parallelism > 100) speed += 10;
            
            if (retries < 5) speed += 10;
            else if (retries > 8) speed -= 5;
            
            speed = Math.max(0, Math.min(100, speed));

            return {
                detectionLevel,
                speed,
                knocks: retries,
                parallelism
            };
        }

        // Function to update all displays from current parameter values
        function updateFromParams() {
            isCustomMode = true;
            customIndicator.style.display = 'block';
            const maxRtt = parseInt(paramMaxRtt.value);
            const minRtt = parseInt(paramMinRtt.value);
            const initialRtt = parseInt(paramInitialRtt.value);
            const retries = parseInt(paramMaxRetries.value);
            const maxScanDelay = parseInt(paramMaxScanDelay.value);
            const parallelism = parseInt(paramParallelism.value);

            // Update parameter value displays
            paramMaxRttValue.textContent = maxRtt + 'ms';
            paramMinRttValue.textContent = minRtt + 'ms';
            paramInitialRttValue.textContent = initialRtt + 'ms';
            paramMaxRetriesValue.textContent = retries;
            
            if (maxScanDelay === 0) {
                paramMaxScanDelayValue.textContent = 'Adaptive';
            } else if (maxScanDelay >= 1000) {
                paramMaxScanDelayValue.textContent = (maxScanDelay / 1000) + 's';
            } else {
                paramMaxScanDelayValue.textContent = maxScanDelay + 'ms';
            }
            
            paramParallelismValue.textContent = parallelism === 0 ? 'Serial' : '~' + parallelism;

            // Calculate and update metrics
            const metrics = calculateMetricsFromParams();

            // Update detection level
            let detectionText = 'Moderate';
            if (metrics.detectionLevel > 70) detectionText = 'Very Stealth';
            else if (metrics.detectionLevel > 50) detectionText = 'Stealth';
            else if (metrics.detectionLevel > 30) detectionText = 'Low Stealth';
            else detectionText = 'No Stealth';

            detectionLevel.textContent = detectionText;
            detectionLevel.className = 'metric-value detection-level ' + 
                (metrics.detectionLevel > 70 ? '' : metrics.detectionLevel > 30 ? 'medium' : 'low');
            detectionBar.style.width = metrics.detectionLevel + '%';
            detectionBar.style.background = metrics.detectionLevel > 70 ? 
                'linear-gradient(90deg, #27ae60, #2ecc71)' : 
                metrics.detectionLevel > 30 ? 
                'linear-gradient(90deg, #f39c12, #e67e22)' : 
                'linear-gradient(90deg, #e74c3c, #c0392b)';

            // Update speed
            let speedText = 'Normal';
            if (metrics.speed > 85) speedText = 'Maximum';
            else if (metrics.speed > 70) speedText = 'Fast';
            else if (metrics.speed < 20) speedText = 'Extremely Slow';
            else if (metrics.speed < 35) speedText = 'Very Slow';
            else if (metrics.speed < 50) speedText = 'Slow';

            speedValue.textContent = speedText;
            speedBar.style.width = metrics.speed + '%';
            speedBar.style.background = metrics.speed < 30 ? 
                'linear-gradient(90deg, #3498db, #2980b9)' : 
                metrics.speed < 70 ? 
                'linear-gradient(90deg, #2ecc71, #27ae60)' : 
                'linear-gradient(90deg, #f39c12, #e67e22)';

            // Update knocks
            knocksValue.textContent = metrics.knocks + ' retries';
            const knocksPercent = (metrics.knocks / 10) * 100;
            knocksBar.style.width = knocksPercent + '%';
            knocksBar.textContent = metrics.knocks + ' retries';

            // Update parallelism
            const parallelismText = parallelism === 0 ? 'Serial (1 at a time)' : 
                                   parallelism < 50 ? 'Very Low (~' + parallelism + ')' :
                                   parallelism < 100 ? 'Low (~' + parallelism + ')' :
                                   parallelism < 200 ? 'Dynamic (~' + parallelism + ')' :
                                   parallelism < 250 ? 'High (~' + parallelism + ')' :
                                   'Maximum (~' + parallelism + '+)';
            
            parallelismValue.textContent = parallelismText;
            const parallelismPercent = (parallelism / 300) * 100;
            parallelismBar.style.width = parallelismPercent + '%';
            if (parallelism === 0) {
                parallelismBar.textContent = 'Serial';
            } else {
                parallelismBar.textContent = '~' + parallelism + ' probes';
            }

            // Update timing arguments display
            const maxScanDelayText = maxScanDelay === 0 ? '0 (adaptive)' : 
                                   maxScanDelay >= 1000 ? (maxScanDelay / 1000) + 's' : 
                                   maxScanDelay + 'ms';

            timingArgs.innerHTML = `
                <div class="arg-item">
                    <span class="arg-label">--max-rtt-timeout</span>
                    <span class="arg-value">${maxRtt}ms</span>
                </div>
                <div class="arg-item">
                    <span class="arg-label">--min-rtt-timeout</span>
                    <span class="arg-value">${minRtt}ms</span>
                </div>
                <div class="arg-item">
                    <span class="arg-label">--initial-rtt-timeout</span>
                    <span class="arg-value">${initialRtt}ms</span>
                </div>
                <div class="arg-item">
                    <span class="arg-label">--max-retries</span>
                    <span class="arg-value">${retries}</span>
                </div>
                <div class="arg-item">
                    <span class="arg-label">--max-scan-delay</span>
                    <span class="arg-value">${maxScanDelayText}</span>
                </div>
            `;

            // Build and update granular command
            let cmd = 'nmap';
            
            cmd += ` --max-rtt-timeout ${maxRtt}ms`;
            cmd += ` --min-rtt-timeout ${minRtt}ms`;
            cmd += ` --initial-rtt-timeout ${initialRtt}ms`;
            cmd += ` --max-retries ${retries}`;
            
            if (maxScanDelay > 0) {
                if (maxScanDelay >= 1000) {
                    cmd += ` --max-scan-delay ${maxScanDelay / 1000}s`;
                } else {
                    cmd += ` --max-scan-delay ${maxScanDelay}ms`;
                }
            }
            
            cmd += ' target';
            
            granularNmapCommand.textContent = cmd;
        }

        // Add event listeners to parameter sliders
        paramMaxRtt.addEventListener('input', updateFromParams);
        paramMinRtt.addEventListener('input', updateFromParams);
        paramInitialRtt.addEventListener('input', updateFromParams);
        paramMaxRetries.addEventListener('input', updateFromParams);
        paramMaxScanDelay.addEventListener('input', updateFromParams);
        paramParallelism.addEventListener('input', updateFromParams);

        slider.addEventListener('input', (e) => {
            updateMetrics(parseInt(e.target.value));
        });

        // Initialize with default value
        updateMetrics(3);
    </script>
</body>
</html>
